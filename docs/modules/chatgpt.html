<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>chatgpt.py — MPTB_vhsell</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<header>
    <h1>chatgpt.py</h1>
    <nav><a href="../index.html">Inicio</a> · <a href="modules.html">Módulos</a></nav>
</header>
<main>
    <section class="card">
        <h2>Resumen</h2>
        <p>Este módulo expone la función <code>gpt(message)</code> que integra el proyecto con un cliente compatible con OpenAI (en este repo, la variable <code>model</code> se inicializa en <code>modules/gvar.py</code> si hay una API key).</p>
    </section>

    <section class="card">
        <h2>Función principal</h2>
        <h3><code>gpt(message: Message)</code></h3>
        <p>Flujo:</p>
        <ol>
            <li>Valida que <code>message</code> y <code>message.text</code> no sean <code>None</code>.</li>
            <li>Hace una llamada al API de IA con:</li>
            <pre>response = model.responses.create(
    model="gpt-5-nano",
    input=message.text,
)</pre>
            <li>Extrae <code>response.output_text</code>, reemplaza las secuencias <code>\n</code> por saltos de línea reales y responde al usuario con <code>await_exec(message.reply_text, [res])</code>.</li>
        </ol>
    </section>

    <section class="card">
        <h2>Dependencias y supuestos</h2>
        <ul>
            <li>La variable <code>model</code> debe existir y estar inicializada (en <code>gvar.py</code>) con una instancia compatible (p.ej. <code>openai.OpenAI(...)</code>).</li>
            <li>Se usa una función auxiliar <code>await_exec</code> (definida en <code>modules/utils.py</code>) para ejecutar la coroutine de respuesta en el loop de eventos compartido.</li>
        </ul>
    </section>

    <section class="card">
        <h2>Mejoras propuestas</h2>
        <ul>
            <li>Control de errores en la llamada a la API (timeouts, excepciones de red, límites de tasa).</li>
            <li>Implementar manejo de contexto (historial de conversación) si se desea mantener estado entre mensajes.</li>
            <li>Limitar la longitud de entrada o validar el contenido antes de enviar a la API.</li>
        </ul>
    </section>

    <footer>
        <p>Archivo: <code>modules/chatgpt.py</code></p>
    </footer>
</main>
</body>
</html>