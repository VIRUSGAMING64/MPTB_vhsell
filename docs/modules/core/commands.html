<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>core/commands.py — MPTB_vhsell</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
<header>
    <h1>core/commands.py</h1>
    <nav><a href="../../index.html">Inicio</a> · <a href="../../modules.html">Módulos</a></nav>
</header>
<main>
    <section class="card">
        <h2>Resumen</h2>
        <p>Implementa comandos de bot que son invocados desde el diccionario <code>commands</code> en <code>modules/gvar.py</code>. Muchas funciones están como <code>pass</code> o parcialmente implementadas (WIP).</p>
    </section>

    <section class="card">
        <h3>Funciones expuestas</h3>
        <ul>
            <li><code>start(message)</code>: envía un mensaje de bienvenida usando <code>asyncio.run_coroutine_threadsafe</code> en el loop global.</li>
            <li><code>kill(message)</code>: responde y finaliza el proceso con <code>os._exit(0)</code>.</li>
            <li><code>upload(message)</code>: placeholder; extrae argumentos y llama a <code>getfullpath</code>.</li>
            <li><code>help_bot(message)</code>: envía mensaje de ayuda (WIP).</li>
            <li>Comandos de sistema de archivos: <code>ls</code>, <code>rm</code>, <code>mkdir</code>, <code>ren</code>, <code>size</code>, <code>comp</code> — actualmente sin implementación.</li>
        </ul>
    </section>

    <section class="card">
        <h3>Detalles de implementación</h3>
        <p>Algunas funciones ejecutan coroutines thread-safe para integrar código sincrónico con el loop asíncrono. Ejemplo:</p>
        <pre>asyncio.run_coroutine_threadsafe(message.reply_text("Hello!..."), loop)</pre>
        <p>Esto depende de que exista una variable global <code>loop</code> en <code>modules/utils.py</code>.</p>
    </section>

    <section class="card">
        <h2>Riesgos y observaciones</h2>
        <ul>
            <li>Usar <code>os._exit(0)</code> para detener el bot es abrupto; preferir un shutdown ordenado (cerrar hilos, pool y loop).</li>
            <li>Faltan validaciones de argumentos y control de errores.</li>
            <li>Implementar autenticación/chequeo de permisos (solo admins) para comandos sensibles como <code>/kill</code>.</li>
        </ul>
    </section>

    <footer>
        <p>Archivo: <code>modules/core/commands.py</code></p>
    </footer>
</main>
</body>
</html>